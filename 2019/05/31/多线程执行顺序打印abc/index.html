<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://ww1.sinaimg.cn/large/90c0a921ly1g8zusrjr01j20cs0csq43.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="http://ww1.sinaimg.cn/large/90c0a921ly1g8zusrjr01j20cs0csq43.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="Wayne" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="面试的时候遇到的一道题，怪自己贪快了，但是学多线程的时候只是把书上的例子敲了一遍，没有再做别的实践。刚好现在就着这道题把多线程的知识巩固一遍。题目：三个线程，要求线程1打印A,线程2打印B,线程3打印C,且要求ABC顺序打印10次思考：多线程基础API首先，最基础的需要用到多线程多线程相关API在基于线程的并发编程一文中有过较为详细的介绍，这里不做赘述。">
<meta name="keywords" content="多线程">
<meta property="og:type" content="article">
<meta property="og:title" content="多线程执行顺序打印abc">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;05&#x2F;31&#x2F;%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0abc&#x2F;index.html">
<meta property="og:site_name" content="Wayne">
<meta property="og:description" content="面试的时候遇到的一道题，怪自己贪快了，但是学多线程的时候只是把书上的例子敲了一遍，没有再做别的实践。刚好现在就着这道题把多线程的知识巩固一遍。题目：三个线程，要求线程1打印A,线程2打印B,线程3打印C,且要求ABC顺序打印10次思考：多线程基础API首先，最基础的需要用到多线程多线程相关API在基于线程的并发编程一文中有过较为详细的介绍，这里不做赘述。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-11-17T04:23:05.319Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2019/05/31/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0abc/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>多线程执行顺序打印abc | Wayne</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wayne</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">麤缯大布裹生涯，腹有诗书气自华</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/31/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0abc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/90c0a921ly1g8zusrjr01j20cs0csq43.jpg">
      <meta itemprop="name" content="Wayne">
      <meta itemprop="description" content="Wwayne">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wayne">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          多线程执行顺序打印abc
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-31 16:12:56" itemprop="dateCreated datePublished" datetime="2019-05-31T16:12:56+08:00">2019-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-17 12:23:05" itemprop="dateModified" datetime="2019-11-17T12:23:05+08:00">2019-11-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">网络编程</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>面试的时候遇到的一道题，怪自己贪快了，但是学多线程的时候只是把书上的例子敲了一遍，没有再做别的实践。刚好现在就着这道题把多线程的知识巩固一遍。</p><p>题目：三个线程，要求线程1打印A,线程2打印B,线程3打印C,且要求ABC顺序打印10次</p><p>思考：</p><h1 id="多线程基础API"><a href="#多线程基础API" class="headerlink" title="多线程基础API"></a>多线程基础API</h1><p>首先，最基础的需要用到多线程</p><p>多线程相关API在<a href="https://wwayne1.github.io/2019/05/07/%E5%9F%BA%E4%BA%8E%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" target="_blank" rel="noopener">基于线程的并发编程</a>一文中有过较为详细的介绍，这里不做赘述。</p><a id="more"></a>




<h1 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h1><p>进一步说，如果直接打印，会因为多线程抢占资源而导致顺序不定，且每次输出结果不唯一的情况。因此需要用一个共享变量cnt去计数自己下一步需要打印什么，而为了保证对共享变量的更改正确，又需要用到互斥锁保证线程同步，资源不被抢占。</p>
<p>　　互斥锁用来保证一段时间内只有一个线程在执行一段代码。必要性显而易见：假设各个线程向同一个文件顺序写入数据，最后得到的结果一定是灾难性的。</p>
<p>互斥锁是通过锁的机制来实现线程间的同步问题。互斥锁的基本流程为：</p>
<ul>
<li>初始化一个互斥锁：pthread_mutex_init()<!--动态分配的互斥量！--></li>
<li>加锁：pthread_mutex_lock()函数或者pthread_mutex_trylock()函数</li>
<li>对共享资源的操作</li>
<li>解锁：pthread_mutex_unlock()函数</li>
<li>注销互斥锁：pthread_mutex_destory()<!--动态分配的互斥量！！！--></li>
</ul>
<p>其中，在加锁过程中，pthread_mutex_lock()函数和pthread_mutex_trylock()函数的过程略有不同：</p>
<ul>
<li>当使用pthread_mutex_lock()函数进行加锁时，若此时已经被锁，则尝试加锁的线程会被阻塞，直到互斥锁被其他线程释放，当pthread_mutex_lock()函数有返回值时，说明加锁成功；</li>
<li>而使用pthread_mutex_trylock()函数进行加锁时，若此时已经被锁，则会返回EBUSY的错误码。</li>
</ul>
<p>同时，解锁的过程中，也需要满足两个条件：</p>
<ul>
<li>解锁前，互斥锁必须处于锁定状态；</li>
<li>必须由加锁的线程进行解锁。</li>
</ul>
<p><u>需要注意的是，动态分配的互斥锁在malloc后必须使用pthread_mutex_init()初始化，free之前也必须使用pthread_mutex_destory()进行清除。静态分配的则只需要初始化为PTHREAD_MUTEX_INITIALIZER就好了</u></p>
<h1 id="线程等待和激活"><a href="#线程等待和激活" class="headerlink" title="线程等待和激活"></a>线程等待和激活</h1><p>那么当一个线程不需要打印(没有满足打印条件)的时候，则需要用到线程等待和激活的知识</p>
<p>首先介绍几个api：</p>
<p>pthread_cond_t表示多线程的条件变量，用于控制线程等待和就绪的条件。</p>
<h2 id="条件变量的初始化："><a href="#条件变量的初始化：" class="headerlink" title="条件变量的初始化："></a>条件变量的初始化：</h2><p>条件变量和<a href="http://baike.baidu.com/view/1461738.htm" target="_blank" rel="noopener">互斥锁</a>一样，都有静态动态两种创建方式，</p>
<p>静态方式使用PTHREAD_COND_INITIALIZER<a href="http://baike.baidu.com/view/346799.htm" target="_blank" rel="noopener">常量</a>初始化。</p>
<p>pthread_cond_t cond = PTHREAD_COND_INITIALIZER;</p>
<p>动态方式初始化：</p>
<ol>
<li>首先要new或者malloc一个pthread_cond_t类型变量，</li>
</ol>
<p>​       用完后记得delete或者free掉。</p>
<ol start="2">
<li>动态方式调用<a href="http://baike.baidu.com/view/3750966.htm" target="_blank" rel="noopener">pthread_cond_init</a>()函数，API定义如下：</li>
</ol>
<p>​        int pthread_cond_init(pthread_cond_t *cond, pthread_condattr_t *cond_attr);</p>
<h2 id="条件变量的销毁"><a href="#条件变量的销毁" class="headerlink" title="条件变量的销毁"></a>条件变量的销毁</h2><p>注销一个条件变量需要调用pthread_cond_destroy()，只有在没有线程在该条件变量上等待的时候才能注销这个条件变量，否则返回EBUSY。</p>
<p>因为Linux实现的条件变量没有分配什么资源，所以注销动作只包括检查是否有等待线程。API定义如下：</p>
<p>int pthread_cond_destroy(pthread_cond_t *cond)</p>
<p>new开辟的pthread_cond_t记得在调用pthread_cond_destroy()后调用delete或者free销毁掉。</p>
<h2 id="等待和触发"><a href="#等待和触发" class="headerlink" title="等待和触发"></a>等待和触发</h2><ol>
<li>条件等待</li>
</ol>
<p>int pthread_cond_wait(pthread_cond_t * cond, pthread_mutex_t * mutex); </p>
<ol start="2">
<li>时间等待</li>
</ol>
<p>int pthread_cond_timedwait(pthread_cond_t *cond, pthread_mutex_t *mutex, const struct timespec *abstime);</p>
<p> 其中计时等待方式如果在给定时刻前条件没有满足，则返回ETIMEOUT，结束等待，</p>
<p>其中abstime以与time()<a href="http://baike.baidu.com/view/47173.htm" target="_blank" rel="noopener">系统调用</a>相同意义的绝对时间形式出现，0表示<a href="http://baike.baidu.com/view/21246.htm" target="_blank" rel="noopener">格林尼治时间</a>1970年1月1日0时0分0秒。 </p>
<p>无论哪种等待方式，都必须和一个<a href="http://baike.baidu.com/view/1461738.htm" target="_blank" rel="noopener">互斥锁</a>配合，以防止多个线程同时请求pthread_cond_wait()（或pthread_cond_timedwait()，下同）的<a href="http://baike.baidu.com/view/1346461.htm" target="_blank" rel="noopener">竞争条件</a>（Race Condition）。mutex互斥锁必须是普通锁（PTHREAD_MUTEX_TIMED_NP）或者适应锁（PTHREAD_MUTEX_ADAPTIVE_NP），且在调用pthread_cond_wait()前必须由本<a href="http://baike.baidu.com/view/1053.htm" target="_blank" rel="noopener">线程</a>加锁（pthread_mutex_lock()），而在更新条件<a href="http://baike.baidu.com/view/4083731.htm" target="_blank" rel="noopener">等待队列</a>以前，mutex保持锁定状态，并在线程挂起进入等待前解锁。在条件满足从而离开pthread_cond_wait()之前，mutex将被重新加锁，以与进入pthread_cond_wait()前的加锁动作对应。</p>
<p>使用pthread_cond_wait方式如下：</p>
<blockquote>
<p>​    pthread _mutex_lock(&amp;mutex)</p>
<p>​    while或if(线程执行的条件是否成立)</p>
<p>​          pthread_cond_wait(&amp;cond, &amp;mutex);</p>
<p>​    线程执行</p>
<p>​    pthread_mutex_unlock(&amp;mutex);</p>
</blockquote>
<ol start="3">
<li>激发条件有两种形式，pthread_cond_signal()激活一个等待该条件的线程，存在多个等待线程时按入队顺序激活其中一个；而pthread_cond_broadcast()则激活所有等待线程。</li>
</ol>
<p> 上面就是多线程条件变量的基础知识，下面着重阐述下为什么调用pthread_cond_wait之前要加锁，以及pthread_cond_wait内部调用了什么。</p>
<p>  首先解释为什么在等待前加锁，因为线程隶属于进程，线程共享进程的资源，如果不进行加锁，就会造成多个线程同时（相对意义的同时，可能一个线程在函数A中更改此共享资源，此时函数A没结束，另一个线程也访问了这个共享资源）访问这块共享的资源，如果对临界区的内容进行更改，那么两个线程就会造成数据的不准确。所以在更改临界资源的时候要枷锁。而调用pthread_cond_wait之前要加锁也是为了避免多个线程竞争一个条件，造成共享的资源被多个线程更改。所以需要互斥的访问共有资源。那么在pthread_cond_wait之前需要加锁，避免别的线程更改共有资源。</p>
<p>  接下来思考pthread_cond_wait内部做了哪些操作。</p>
<p>在pthread_cond_wait调用之前，线程调用pthread_mutex_lock,设置锁，如果条件不满足，那么该线程处于阻塞等待的状态。别的线程发现条件满足后会调用pthread_cond_signal或pthread_cond_broadcast通知他。那么问题出来了，如果该线程不解锁，别的线程是没办法更改共享资源的，也就没办法设置条件变量使其满足该线程的等待条件，出现死锁。所以，pthread_cond_wait会在内部进行解锁操作。别的线程可以访问共享资源，更改条件触发该线程，是该线程从阻塞状态变为就绪。慢一点，还有一个重要的步骤，pthread_cond_wait会将该线程放到线程等待队列里，那么是在放到等待队列之前解锁还是放到等待队列之后才解锁呢？</p>
<blockquote>
<p>对于这点apue给出的解释：</p>
<p>The mutex passed to pthread_cond_wait protects the condition.The caller passes it locked to the function, which then atomically places the calling thread on the list of threads waiting for the condition and unlocks the mutex. This closes the window between the time that the condition is checked and the time that the thread goes to sleep waiting for the condition to change, so that the thread doesn’t miss a change in the condition. When pthread_cond_wait returns, the mutex is again locked.</p>
</blockquote>
<p> 这段话的意思是mutex传递给pthread_cond_wait 用于保护条件，调用者将mutex传递给pthread_cond_wait，pthread_cond_wait 会自动将调用该函数的线程放到线程等待队列上，等待条件并且解锁。这种做法关闭了一段间隙，这段间隙就是在我们检测条件的时刻和将线程放到等待队列休眠的时刻之间，这么做该线程不会错过条件的改变。而当pthread_cond_wait 返回时，mutex又被上锁了。</p>
<p><strong>所以，pthread_cond_wait内部的操作顺序是将线程放到等待队列，然后解锁，等条件满足时进行加锁，然后返回。</strong></p>
<p><strong>整理下pthread_cond_wait内部操作</strong></p>
<ol>
<li><p><strong>线程放在等待队列上，解锁</strong></p>
</li>
<li><p><strong>等待 pthread_cond_signal或者pthread_cond_broadcast信号之后去竞争锁</strong></p>
</li>
<li><p><strong>若竞争到互斥索则加锁。</strong></p>
</li>
</ol>
<blockquote>
<p>使用流程</p>
<p>等待线程：</p>
<p>pthread_mutex_lock(&amp;mutex);</p>
<p>if(条件不满足)</p>
<p>　　pthread_cond_wait(&amp;cond, &amp;mutex);</p>
<p>//处理共享资源</p>
<p>pthread_mutex_unlock(&amp;mutex);</p>
</blockquote>
<blockquote>
<p>激活线程：</p>
<p>pthread_mutex_lock(&amp;mutex);</p>
<p>pthread_cond_signal(&amp;cond);</p>
<p>pthread_mutex_unlock(&amp;mutex);</p>
</blockquote>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>将逻辑串联起来，就把这道题解出来了，最后上代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> item 3</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line">	<span class="keyword">pthread_cond_t</span> cond;</span><br><span class="line">	<span class="keyword">int</span> cnt;</span><br><span class="line">&#125;test = &#123;</span><br><span class="line">	PTHREAD_MUTEX_INITIALIZER,</span><br><span class="line">	PTHREAD_COND_INITIALIZER,</span><br><span class="line">	<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">thread</span><span class="params">(<span class="keyword">void</span> *varpg)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pthread_t</span> t[item];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"开始打印\n"</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; item; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> *a = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">		*a = i;</span><br><span class="line">		pthread_create(&amp;t[i], <span class="literal">NULL</span>, &amp;thread, a);</span><br><span class="line">		<span class="built_in">free</span>(a);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; item; i++)</span><br><span class="line">		pthread_join(t[i],<span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">thread</span><span class="params">(<span class="keyword">void</span> *varpg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> myid = *(<span class="keyword">int</span>*)varpg;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pthread_mutex_lock(&amp;test.mutex);</span><br><span class="line">		<span class="keyword">while</span> (test.cnt != myid)</span><br><span class="line">			pthread_cond_wait(&amp;test.cond,&amp;test.mutex);</span><br><span class="line">		<span class="keyword">if</span> (myid != <span class="number">2</span>)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%c"</span>,<span class="string">'A'</span>+myid);</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%c\n"</span>,<span class="string">'A'</span>+myid);</span><br><span class="line">		test.cnt = (test.cnt + <span class="number">1</span>)%item;</span><br><span class="line">		pthread_mutex_unlock(&amp;test.mutex);</span><br><span class="line">		pthread_cond_broadcast(&amp;test.cond);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag"># 多线程</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/05/07/%E5%9F%BA%E4%BA%8E%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="next" title="基于线程的并发编程">
                  <i class="fa fa-chevron-left"></i> 基于线程的并发编程
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/06/05/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/" rel="prev" title="c/c++内存对齐">
                  c/c++内存对齐 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#多线程基础API"><span class="nav-number">1.</span> <span class="nav-text">多线程基础API</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#互斥锁"><span class="nav-number">2.</span> <span class="nav-text">互斥锁</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#线程等待和激活"><span class="nav-number">3.</span> <span class="nav-text">线程等待和激活</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#条件变量的初始化："><span class="nav-number">3.1.</span> <span class="nav-text">条件变量的初始化：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#条件变量的销毁"><span class="nav-number">3.2.</span> <span class="nav-text">条件变量的销毁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#等待和触发"><span class="nav-number">3.3.</span> <span class="nav-text">等待和触发</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#代码"><span class="nav-number">4.</span> <span class="nav-text">代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wayne"
      src="http://ww1.sinaimg.cn/large/90c0a921ly1g8zusrjr01j20cs0csq43.jpg">
  <p class="site-author-name" itemprop="name">Wayne</p>
  <div class="site-description" itemprop="description">Wwayne</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Wwayne1" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Wwayne1" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wayne</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">25k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">23 分钟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
